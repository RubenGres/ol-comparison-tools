/**
* Author: Thomas Tilak
* github: https://github.com/thhomas/ol-comparison-tools
* licence: MIT
*/

ol.control.ComparisonTools=function(e){e||(e={}),this.controls_=[],this.clonedMap_,this.clonedLayer_,this.rightLayer_,this.leftLayer_,this.displayMode_="normal",this.vSwipeControl_,this.hSwipeControl_,ol.control.Bar.call(this,{group:!0,toggleOne:!0,className:e.className,controls:this.controls_});var t=e.controlNames||["hSlider","vSlider","scope","clipLayer","doubleMap"];e.rightLayer&&(this.rightLayer_=e.rightLayer),e.leftLayer&&(this.leftLayer_=e.leftLayer);for(var o=0;o<t.length;o++){var i=t[o];if("vSlider"===i){var l=new ol.control.Toggle({html:'<i class="fa fa-arrows-v"></i>',className:"vertical-button",title:"Comparaison verticale",active:!1});l.set("name",i+"Toggle"),l.on("change:active",this.onVerticalControlChange_,this),this.addControl(l)}else if("hSlider"===i){var a=new ol.control.Toggle({html:'<i class="fa fa-arrows-h"></i>',className:"horizontal-button",title:"Comparaison horizontale",active:!1});a.set("name",i+"Toggle"),a.on("change:active",this.onHorizontalControlChange_,this),this.addControl(a)}else if("scope"===i){var r=new ol.control.Toggle({html:'<i class="fa fa-circle-o"></i>',className:"scope-button",name:"scope",title:"Loupe",active:!1});r.set("name",i+"Toggle"),r.on("change:active",this.onScopeControlChange_,this),this.addControl(r)}else if("clipLayer"===i){var n=new ol.control.Toggle({html:'<i class="fa fa-eye"></i>',className:"clipLayer-button",title:"Masquer",active:!1});n.set("name",i+"Toggle"),n.on("change:active",this.onClipLayerControlChange_,this),this.addControl(n)}else if("doubleMap"===i){var s=new ol.control.Toggle({html:'<i class="fa fa-pause"></i>',className:"doubleMap-button",name:"doubleMap",title:"Double affichage",active:!1});s.set("name",i+"Toggle"),s.on("change:active",this.onDoubleMapControlChange_,this),this.addControl(s)}}},ol.inherits(ol.control.ComparisonTools,ol.control.Bar),ol.control.ComparisonTools.prototype.setMap=function(e){if(ol.control.Bar.prototype.setMap.call(this,e),this.getControl("doubleMapToggle")){var t=$(e.getViewport().parentElement),o=t.attr("id");if(void 0===o)throw new EvalError("ol.Map div must have an id.");var i=$('<div id="'+o+'-cloned"></div>');i.hide(),t.parent().append(i),this.clonedMap_=new ol.Map({target:i[0],renderer:e.renderer,interactions:ol.interaction.defaults(),view:e.getView(),controls:[new ol.control.Zoom({zoomInTipLabel:"Zoom avant",zoomOutTipLabel:"Zoom arri√®re"}),new ol.control.Rotate,void 0!==ol.control.GeoportalAttribution?new ol.control.GeoportalAttribution:new ol.control.Attribution]}),e.addInteraction(new ol.interaction.Synchronize({maps:[this.clonedMap_]})),this.clonedMap_.addInteraction(new ol.interaction.Synchronize({maps:[e]}))}},ol.control.ComparisonTools.prototype.getControl=function(e){for(var t=0;t<this.getControls().length;t++)if(this.getControls()[t].get("name")===e)return this.getControls()[t]},ol.control.ComparisonTools.prototype.onVerticalControlChange_=function(e){e.active?(this.displayMode_="vSlider",this.vSwipeControl_=new ol.control.Swipe({layers:this.getLeftLayer(),rightLayers:this.getRightLayer(),orientation:"vertical"}),this.vSwipeControl_.set("name","vSlider"),this.getMap().addControl(this.vSwipeControl_)):(this.displayMode_="normal",this.vSwipeControl_&&(this.getMap().removeControl(this.vSwipeControl_),this.vSwipeControl_=void 0))},ol.control.ComparisonTools.prototype.onHorizontalControlChange_=function(e){e.active?(this.displayMode_="hSlider",this.hSwipeControl_=new ol.control.Swipe({layers:this.getLeftLayer(),rightLayers:this.getRightLayer(),orientation:"horizontal"}),this.hSwipeControl_.set("name","hSlider"),this.getMap().addControl(this.hSwipeControl_)):(this.displayMode_="normal",this.hSwipeControl_&&(this.getMap().removeControl(this.hSwipeControl_),this.hSwipeControl_=void 0))},ol.control.ComparisonTools.prototype.onScopeControlChange_=function(e){var t=this.getControl("scopeToggle");e.active?(this.displayMode_="scope",t.setInteraction(new ol.interaction.Clip({radius:200})),this.getMap().addInteraction(t.getInteraction()),t.getInteraction().addLayer(this.getRightLayer())):(this.displayMode_="normal",t.getInteraction()&&(t.getInteraction().removeLayer(this.getRightLayer()),this.getMap().removeInteraction(t.getInteraction()),t.setInteraction()))},ol.control.ComparisonTools.prototype.onClipLayerControlChange_=function(e){var t=this.getControl("clipLayerToggle");e.active?(this.displayMode_="clipLayer",this.getRightLayer().setVisible(!1),t.element.getElementsByClassName("fa")[0].className="fa fa-eye-slash"):(this.displayMode_="normal","doubleMap"!==this.getDisplayMode()&&this.getRightLayer().setVisible(!0),t.element.getElementsByClassName("fa")[0].className="fa fa-eye")},ol.control.ComparisonTools.prototype.onDoubleMapControlChange_=function(e){this.getControl("doubleMapToggle");var t=this.getMap().getViewport().parentElement,o=this.getClonedMap().getViewport().parentElement;e.active?(this.displayMode_="doubleMap",o.style.float="left",o.style.width="50%",t.style.width="50%",t.style.float="left",o.style.display="block",o.style.height=t.clientHeight+"px",this.clonedLayer_=new ol.layer.Tile(this.getRightLayer().getProperties()),this.clonedLayer_.setVisible(!0),this.getRightLayer().setVisible(!1),this.getClonedMap().addLayer(this.clonedLayer_),this.getMap().updateSize(),this.getClonedMap().updateSize()):(this.displayMode_="normal",o.style.display="none",o.style.width="100%",t.style.width="100%",this.getClonedMap().removeLayer(this.clonedLayer_),"clipLayer"!==this.getDisplayMode()&&this.getRightLayer().setVisible(!0),this.getMap().updateSize())},ol.control.ComparisonTools.prototype.setDisplayMode=function(e){if(!this.getMap())throw new EvalError("control must be added to map before setting displayMode.");this.getControl("vSliderToggle").setActive(!1),this.getControl("hSliderToggle").setActive(!1),this.getControl("scopeToggle").setActive(!1),this.getControl("clipLayerToggle").setActive(!1),this.getControl("doubleMapToggle").setActive(!1),"vSlider"===e?this.getControl("vSliderToggle").setActive(!0):"hSlider"===e?this.getControl("hSliderToggle").setActive(!0):"scope"===e?this.getControl("scopeToggle").setActive(!0):"clipLayer"===e?this.getControl("clipLayerToggle").setActive(!0):"doubleMap"===e&&this.getControl("doubleMapToggle").setActive(!0)},ol.control.ComparisonTools.prototype.getDisplayMode=function(){return this.displayMode_},ol.control.ComparisonTools.prototype.setRightLayer=function(e){if("vSlider"===this.getDisplayMode()){var t;this.getMap().getControls().forEach(function(e){"vSlider"===e.get("name")&&(t=e)}),t.removeLayer(this.rightLayer_),t.addLayer(e,!0)}else if("hSlider"===this.getDisplayMode()){var o;this.getMap().getControls().forEach(function(e){"hSlider"===e.get("name")&&(o=e)}),o.removeLayer(this.rightLayer_),o.addLayer(e,!0)}else if("clipLayer"===this.getDisplayMode())e.setVisible(this.rightLayer_.getVisible());else if("scope"===this.getDisplayMode()){var i=this.getControl("scopeToggle").getInteraction();i.removeLayer(this.rightLayer_),i.addLayer(e)}else"doubleMap"===this.getDisplayMode()&&(this.getClonedMap().removeLayer(this.clonedLayer_),this.clonedLayer_=new ol.layer.Tile(e.getProperties()),this.getClonedMap().addLayer(this.clonedLayer_),e.setVisible(!1));this.rightLayer_=e},ol.control.ComparisonTools.prototype.setLeftLayer=function(e){this.leftLayer_=e;var t;this.getMap().getControls().forEach(function(e){"vSlider"===e.get("name")&&(t=e)}),t&&t.addLayer(this.leftLayer_);var o;this.getMap().getControls().forEach(function(e){"hSlider"===e.get("name")&&(o=e)}),o&&o.addLayer(this.leftLayer_)},ol.control.ComparisonTools.prototype.getRightLayer=function(){return this.rightLayer_},ol.control.ComparisonTools.prototype.getLeftLayer=function(){return this.leftLayer_},ol.control.ComparisonTools.prototype.getClonedMap=function(){return this.clonedMap_};