/**
* Author: Thomas Tilak
* github: https://github.com/thhomas/ol-comparison-tools
* licence: MIT
*/

ol.control.ComparisonTools=function(t){t||(t={}),this.controls_=[],this.clonedMap_,this.clonedLayer_,this.rightLayer_,this.leftLayer_,this.vSwipeControl_,this.hSwipeControl_,ol.control.Bar.call(this,{group:!0,toggleOne:!0,className:t.className,controls:this.controls_});var e=t.controlNames||["hSlider","vSlider","scope","clipLayer","doubleMap"];t.rightLayer&&(this.rightLayer_=t.rightLayer),t.leftLayer&&(this.leftLayer_=t.leftLayer);for(var o=0;o<e.length;o++){var i=e[o];if("vSlider"===i){var r=new ol.control.Toggle({html:'<i class="fa fa-arrows-v"></i>',className:"vertical-button",title:"Comparaison verticale",active:!1});r.set("name",i+"Toggle"),r.on("change:active",this.onVerticalControlChange_,this),this.addControl(r)}else if("hSlider"===i){var a=new ol.control.Toggle({html:'<i class="fa fa-arrows-h"></i>',className:"horizontal-button",title:"Comparaison horizontale",active:!1});a.set("name",i+"Toggle"),a.on("change:active",this.onHorizontalControlChange_,this),this.addControl(a)}else if("scope"===i){var l=new ol.control.Toggle({html:'<i class="fa fa-circle-o"></i>',className:"scope-button",name:"scope",title:"Loupe",active:!1});l.set("name",i+"Toggle"),l.on("change:active",this.onScopeControlChange_,this),this.addControl(l)}else if("clipLayer"===i){var n=new ol.control.Toggle({html:'<i class="fa fa-eye"></i>',className:"clipLayer-button",title:"Masquer",active:!1});n.set("name",i+"Toggle"),n.on("change:active",this.onClipLayerControlChange_,this),this.addControl(n)}else if("doubleMap"===i){var s=new ol.control.Toggle({html:'<i class="fa fa-pause"></i>',className:"doubleMap-button",name:"doubleMap",title:"Double affichage",active:!1});s.set("name",i+"Toggle"),s.on("change:active",this.onDoubleMapControlChange_,this),this.addControl(s)}}},ol.inherits(ol.control.ComparisonTools,ol.control.Bar),ol.control.ComparisonTools.prototype.setMap=function(t){if(ol.control.Bar.prototype.setMap.call(this,t),this.getControl("doubleMapToggle")){var e=$(t.getViewport().parentElement),o=e.attr("id");if(void 0===o)throw new EvalError("ol.Map div must have an id.");var i=$('<div id="'+o+'-cloned"></div>');i.hide(),e.parent().append(i),this.clonedMap_=new ol.Map({target:i[0],renderer:t.renderer,interactions:ol.interaction.defaults(),view:t.getView(),controls:[new ol.control.Zoom({zoomInTipLabel:"Zoom avant",zoomOutTipLabel:"Zoom arri√®re"}),new ol.control.Rotate,void 0!==ol.control.GeoportalAttribution?new ol.control.GeoportalAttribution:new ol.control.Attribution]}),t.addInteraction(new ol.interaction.Synchronize({maps:[this.clonedMap_]})),this.clonedMap_.addInteraction(new ol.interaction.Synchronize({maps:[t]}))}},ol.control.ComparisonTools.prototype.getControl=function(t){for(var e=0;e<this.getControls().length;e++)if(this.getControls()[e].get("name")===t)return this.getControls()[e]},ol.control.ComparisonTools.prototype.onVerticalControlChange_=function(t){t.active?(this.vSwipeControl_=new ol.control.Swipe({layers:this.getLeftLayer(),rightLayers:this.getRightLayer(),orientation:"vertical"}),this.vSwipeControl_.set("name","vSlider"),this.getMap().addControl(this.vSwipeControl_)):this.vSwipeControl_&&(this.getMap().removeControl(this.vSwipeControl_),this.vSwipeControl_=void 0)},ol.control.ComparisonTools.prototype.onHorizontalControlChange_=function(t){t.active?(this.hSwipeControl_=new ol.control.Swipe({layers:this.getLeftLayer(),rightLayers:this.getRightLayer(),orientation:"horizontal"}),this.hSwipeControl_.set("name","hSlider"),this.getMap().addControl(this.hSwipeControl_)):this.hSwipeControl_&&(this.getMap().removeControl(this.hSwipeControl_),this.hSwipeControl_=void 0)},ol.control.ComparisonTools.prototype.onScopeControlChange_=function(t){var e=this.getControl("scopeToggle");t.active?(e.setInteraction(new ol.interaction.Clip({radius:200})),this.getMap().addInteraction(e.getInteraction()),e.getInteraction().addLayer(this.getRightLayer())):e.getInteraction()&&(e.getInteraction().removeLayer(this.getRightLayer()),this.getMap().removeInteraction(e.getInteraction()),e.setInteraction())},ol.control.ComparisonTools.prototype.onClipLayerControlChange_=function(t){var e=this.getControl("clipLayerToggle");t.active?(this.getRightLayer().setVisible(!1),e.element.getElementsByClassName("fa")[0].className="fa fa-eye-slash"):("doubleMap"!==this.getDisplayMode()&&this.getRightLayer().setVisible(!0),e.element.getElementsByClassName("fa")[0].className="fa fa-eye")},ol.control.ComparisonTools.prototype.onDoubleMapControlChange_=function(t){this.getControl("doubleMapToggle");var e=this.getMap().getViewport().parentElement,o=this.getClonedMap().getViewport().parentElement;t.active?(o.style.float="left",o.style.width="50%",e.style.width="50%",e.style.float="left",o.style.display="block",o.style.height=e.clientHeight+"px",this.clonedLayer_=new ol.layer.Tile(this.getRightLayer().getProperties()),this.clonedLayer_.setVisible(!0),this.getRightLayer().setVisible(!1),this.getClonedMap().addLayer(this.clonedLayer_),this.getMap().updateSize(),this.getClonedMap().updateSize()):(o.style.display="none",o.style.width="100%",e.style.width="100%",this.getClonedMap().removeLayer(this.clonedLayer_),"clipLayer"!==this.getDisplayMode()&&this.getRightLayer().setVisible(!0),this.getMap().updateSize())},ol.control.ComparisonTools.prototype.setDisplayMode=function(t){if(!this.getMap())throw new EvalError("control must be added to map before setting displayMode.");"vSlider"===t?this.getControl("vSliderToggle").setActive(!0):"hSlider"===t?this.getControl("hSliderToggle").setActive(!0):"scope"===t?this.getControl("scopeToggle").setActive(!0):"clipLayer"===t?this.getControl("clipLayerToggle").setActive(!0):"doubleMap"===t&&this.getControl("doubleMapToggle").setActive(!0)},ol.control.ComparisonTools.prototype.getDisplayMode=function(){var t;for(t=0;t<this.getControls().length;t++)if(this.getControls()[t].getActive())return this.getControls()[t].get("name").substring(0,this.getControls()[t].get("name").length-6);return"normal"},ol.control.ComparisonTools.prototype.setRightLayer=function(t){if("vSlider"===this.getDisplayMode()){var e;this.getMap().getControls().forEach(function(t){"vSlider"===t.get("name")&&(e=t)}),e.removeLayer(this.rightLayer_),e.addLayer(t,!0)}else if("hSlider"===this.getDisplayMode()){var o;this.getMap().getControls().forEach(function(t){"hSlider"===t.get("name")&&(o=t)}),o.removeLayer(this.rightLayer_),o.addLayer(t,!0)}else if("clipLayer"===this.getDisplayMode())t.setVisible(this.rightLayer_.getVisible());else if("scope"===this.getDisplayMode()){var i=this.getControl("scopeToggle").getInteraction();i.removeLayer(this.rightLayer_),i.addLayer(t)}else"doubleMap"===this.getDisplayMode()&&(this.getClonedMap().removeLayer(this.clonedLayer_),this.clonedLayer_=new ol.layer.Tile(t.getProperties()),this.getClonedMap().addLayer(this.clonedLayer_),t.setVisible(!1));this.rightLayer_=t},ol.control.ComparisonTools.prototype.setLeftLayer=function(t){this.leftLayer_=t;var e;this.getMap().getControls().forEach(function(t){"vSlider"===t.get("name")&&(e=t)}),e&&e.addLayer(this.leftLayer_);var o;this.getMap().getControls().forEach(function(t){"hSlider"===t.get("name")&&(o=t)}),o&&o.addLayer(this.leftLayer_)},ol.control.ComparisonTools.prototype.getRightLayer=function(){return this.rightLayer_},ol.control.ComparisonTools.prototype.getLeftLayer=function(){return this.leftLayer_},ol.control.ComparisonTools.prototype.getClonedMap=function(){return this.clonedMap_};